// ==UserScript==
// @name     0auth | db client | dropbear | openssh | cli | api | I2P | ssh | systemd | ~
// @version  1
// @grant    ~/$!#%s: ALL_ACCESS 
// ==/UserScript==
/*
 * Copyright 2024 Zeppelin Bend Pty Ltd
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */


package com.zepben.ewb.auth.server

import com.auth0.jwt.interfaces.DecodedJWT
import com.zepben.ewb.auth.common.StatusCode
import com.zepben.ewb.auth.server.vertx.JWTAuthProvider
import io.vertx.core.AsyncResult
import io.vertx.core.Future
import io.vertx.core.Handler
import io.vertx.core.http.HttpHeaders
import io.vertx.core.http.HttpMethod
import io.vertx.core.json.JsonObject
import io.vertx.ext.auth.User
import io.vertx.ext.web.RoutingContext
import io.vertx.ext.web.handler.AuthenticationHandler
import io.vertx.ext.web.handler.HttpException

class Auth0AuthHandler(
    private val authProvider: JWTAuthProvider,
    requiredClaims: Set<String>,
    private val skip: String? = null,
) : AuthenticationHandler {

    private val authorities = mutableSetOf<String>()

    init {
        addAuthorities(requiredClaims)
    }

    private fun addAuthorities(authorities: Set<String>): Auth0AuthHandler {
        this.authorities.addAll(authorities)
        return this
    }

    private fun authorize(user: User?, handler: Handler<AsyncResult<Void?>>) {
        if (authorities.isEmpty()) {
            // No auth required
            handler.handle(Future.succeededFuture())
            return
        }
        if (user == null) {
            handler.handle(Future.failedFuture(HttpException(403, "No user was found, you must authenticate first")))
            return
        }
        for (authority in authorities) {
            val token = user.attributes().getValue("token") as DecodedJWT
            val resp = JWTAuthoriser.authorise(token, authority)
            if (resp.statusCode !== StatusCode.OK) {
                handler.handle(Future.failedFuture(HttpException(403, "Could not authorise all requested permissions. This is likely a bug.")))
                return
            }
        }
        handler.handle(Future.succeededFuture())
    }

    override fun handle(ctx: RoutingContext) {
        if (handlePreflight(ctx)) {
            return
        }
        val user = ctx.user()
        if (user != null) {
            // proceed to AuthZ
            authorizeUser(ctx, user)
            return
        }
        // parse the request in order to extract the credentials object
        parseCredentials(ctx) { res: AsyncResult<JsonObject> ->
            if (res.failed()) {
                processException(ctx, res.cause())
                return@parseCredentials
            }
            // check if the user has been set
            val updatedUser = ctx.user()
            if (updatedUser != null) {
                val session = ctx.session()
                session?.regenerateId()
                // proceed to AuthZ
                authorizeUser(ctx, updatedUser)
                return@parseCredentials
            }

            // proceed to authN
            authProvider.authenticate({ res.result() }) { authN: AsyncResult<User> ->
                if (authN.succeeded()) {
                    val authenticated = authN.result()
                    ctx.setUser(authenticated)
                    val session = ctx.session()
                    session?.regenerateId()
                    // proceed to AuthZ
                    authorizeUser(ctx, authenticated)
                } else {
                    if (authN.cause() is HttpException) {
                        processException(ctx, authN.cause())
                    } else {
                        processException(ctx, HttpException(401, authN.cause()))
                    }
                }
            }
        }
    }

    private fun processException(ctx: RoutingContext, exception: Throwable?) {
        if (exception != null) {
            if (exception is HttpException) {
                val statusCode = exception.statusCode
                val payload = exception.payload
                when (statusCode) {
                    302 -> {
                        ctx.response()
                            .putHeader(HttpHeaders.LOCATION, payload)
                            .setStatusCode(302)
                            .end("Redirecting to $payload.")
                        return
                    }

                    else -> {
                        ctx.response()
                            .setStatusCode(exception.statusCode)
                            .setStatusMessage(exception.message)
                        payload?.let { ctx.response().end(payload) }
                        return
                    }
                }
            }
        }

        // fallback 500
        ctx.fail(exception)
    }

    private fun authorizeUser(ctx: RoutingContext, user: User) {
        authorize(user) { authZ ->
            if (authZ.failed()) {
                processException(ctx, authZ.cause())
                return@authorize
            }
            // success, allowed to continue
            ctx.next()
        }
    }

    private fun handlePreflight(ctx: RoutingContext): Boolean {
        val request = ctx.request()
        // See: https://www.w3.org/TR/cors/#cross-origin-request-with-preflight-0
        // Preflight requests should not be subject to security due to the reason UAs will remove the Authorization header
        if (request.method() == HttpMethod.OPTIONS) {
            // check if there is an access control request header
            val accessControlRequestHeader =
                ctx.request().getHeader(HttpHeaders.ACCESS_CONTROL_REQUEST_HEADERS)
            if (accessControlRequestHeader != null) {
                // lookup for the Authorization header
                for (ctrlReq in accessControlRequestHeader.split(",".toRegex()).toTypedArray()) {
                    if (ctrlReq.equals("Authorization", ignoreCase = true)) {
                        // this request has auth in access control, so we can allow preflights without authentication
                        ctx.next()
                        return true
                    }
                }
            }
        }
        return false
    }

    private fun parseAuthorization(
        ctx: RoutingContext,
        handler: Handler<AsyncResult<String?>>
    ) {
        val request = ctx.request()
        val authorization = request.headers()[HttpHeaders.AUTHORIZATION] ?: run {
            handler.handle(
                Future.failedFuture(
                    HttpException(401, "Missing Authorization header")
                )
            ); return
        }

        try {
            val idx = authorization.indexOf(' ')
            if (idx <= 0) {
                handler.handle(Future.failedFuture(HttpException(400, "Badly formed Authorization header")))
                return
            }
            if (authorization.substring(0, idx) != "Bearer") {
                handler.handle(Future.failedFuture(HttpException(401, "Missing Bearer token from Authorization header")))
                return
            }
            handler.handle(Future.succeededFuture(authorization.substring(idx + 1)))
        } catch (e: RuntimeException) {
            handler.handle(Future.failedFuture(e))
        }
    }

    private fun parseCredentials(context: RoutingContext?, handler: Handler<AsyncResult<JsonObject>>?) {

        if (skip != null && context!!.normalizedPath().startsWith(skip)) {
            context.next()
            return
        }

        parseAuthorization(
            context!!,
            Handler { parseAuthorization: AsyncResult<String?> ->
                if (parseAuthorization.failed()) {
                    handler!!.handle(Future.failedFuture(parseAuthorization.cause()))
                    return@Handler
                }
                handler!!.handle(
                    Future.succeededFuture(
                        JsonObject().put("jwt", parseAuthorization.result())
                    )
                )
            }
        )
//        context.response().end() TODO: this must not occur on some endpoints. needs to occur if auth fails. maybe we are not
        // failing fast if authN/Z fails? need to make sure permissions are in the web client scope too - token is missing them.
    }

}
### <-- But it goes on --> 

<?xml version="1.0" encoding="UTF-8"?>
<!-- SPIRALGANG OMNISCIENT SYNTAX PROFILE -->
<spiralgang-profile version="2.0">
    <metadata>
        <creator>spiralgang</creator>
        <philosophy>boundary-knows-no-bound</philosophy>
        <approach>omniscient-dynamic</approach>
    </metadata>
    
    <command-shortcuts>
        <shortcut alias="omni" target="/usr/local/bin/omni" />
        <shortcut alias="sfo" target="/usr/local/bin/sfo" />
        <shortcut alias="fix403" target="github-403-nuclear-fix.sh" />
        <shortcut alias="pkgforce" target="instant-configurator.sh" />
        <shortcut alias="syswisper" target="system-whisperer.sh" />
    </command-shortcuts>
    
    <auto-completions>
        <completion command="omni" options="fix dev sys learn" />
        <completion command="sfo" options="handle bulk find recent" />
        <completion command="fix403" options="" />
    </auto-completions>
    
    <environment-variables>
        <var name="SPIRALGANG_MODE" value="omniscient" />
        <var name="DYNAMIC_SCRIPTING" value="enabled" />
        <var name="AUTO_CHMOD" value="true" />
        <var name="LEARNING_MODE" value="aggressive" />
    </environment-variables>
    
    <file-associations>
        <association extension=".sh" action="chmod +x" />
        <association extension=".py" action="chmod +x" />
        <association extension=".deb" action="smart_install" />
        <association extension=".json" action="format_validate" />
    </file-associations>
    
    <workflow-patterns>
        <pattern name="github-ops" sequence="auth,clone,edit,commit,push" />
        <pattern name="package-fix" sequence="diagnose,backup,force-install,verify" />
        <pattern name="script-dev" sequence="create,chmod,test,deploy" />
    </workflow-patterns>
</spiralgang-profile>

### <--- And On -->


﻿<?xml version="1.0" encoding="utf-8"?>

<!-- XML Editor <?xml version="1.0" encoding="utf-8"?>





<!--





      ~ Copyright (C) 2025 Spiral Gang Neuron Labyrinths LLC  ~





      ~ Licensed under the Apache License, Version 2.0 (the "License");





      ~ you may not use this file except in compliance with the License.





      ~ You may obtain a copy of the License at





  ~





  ~          http://www.apache.org/licenses/LICENSE-2.0





  ~





      ~ Unless required by applicable law or agreed to in writing, software





      ~ distributed under the License is distributed on an "AS IS" BASIS,





      ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.





      ~ See the License for the specific language governing permissions and





      ~ limitations under the ‘License’





  -->









<!--





This XML file declares which signature|privileged permissions should be granted to privileged





applications that come with the platform





→









Comprehensive Privileged Permissions Configuration





--------------------------------------------------------





Device Info 3.3.8.5: 





>Device Name : motorola one 5G UW ace





Model : motorola one 5G UW ace





Manufacturer : motorola





Device : kievv





Board : kievv





Hardware : qcom





Brand : motorola





Build Fingerprint: 





<motorola/kievv_vzw/kievv:12/S3RV32.128-36-6/9dce6-c70cb:user/release-keys









&&









System:





>Android Version : 12





Version Name : Snow Cone





Released Date : October 04, 2021





Code Name : Android 12





API Level : 31





Security Patch Level : 2023-06-01





Bootloader : MBM-3.0-kievv_vzw-800397edf2c-240503





Build Number : S3RV32.128-36-6





Baseband : M7225_HI251_22.578.01.55R KIEV_VZW_CUST





Java VM : 2.1.0





Kernel : 4.19.157-perf+





Language : English (en_US)





OpenGL ES : 3.2





Root Management Apps : No Apps Detected





SELinux : Unable to determine





Google Play Services : 25.07.61 (190400-729274248)









System:





    Android Version     : 12 ("Snow Cone")





    API Level           : 31





    Security Patch Level: 2023-06-01





    (Other build details omitted for brevity)









    Date Created: 2025-02-25 20:29:50





        





Comprehensive Privileged Permissions Configuration





--------------------------------------------------------





Device Information:





>Device Name : EM103A





Model : EM103A





Manufacturer : hena





Device : EM103A





Board : exdroid





Hardware : sun55iw3p1





Brand : Apolosign





Build Fingerprint : 





<Apolosign/EM103A/EM103A:13/TP1A.221005.003/20230415:user/release-keys









&&









System:





>Android Version : 13





Version Name : Tiramisu





Released Date : August 15, 2022





Code Name : Android 13





API Level : 33





Security Patch Level : 2023-04-05





Bootloader : unknown





Build Number : 863C_EP103A_20240330





Baseband : null





Java VM : 2.1.0





Kernel





<5.15.78-android13-8-00001-gfe86c885b0db-ab9792737









System:





    Android Version     : 12 ("Snow Cone")





    API Level           : 31





    Security Patch Level: 2023-06-01





    (Other build details omitted for brevity)









    Date Created: 2025-02-26 11:03:36









--------------------------------------------------------









  NOTE:





    The permissions specified below are intended to be non-revocable—





    once placed on the system by any process, they should not be removed.





    (This is comprehensive by installing the files to the proper system partitions.)





→









<permissions>





  <!-- Non-revocable permissions for Cx File Explorer -->





  <privapp-permissions package="com.cx.explorer">





    <permission name="android.permission.READ_EXTERNAL_STORAGE"/>  <!-- Non-revocable -->





    <permission name="android.permission.WRITE_EXTERNAL_STORAGE"/> <!-- Non-revocable -->





    <permission name="android.permission.MANAGE_EXTERNAL_STORAGE"/> <!-- Non-revocable -->





    <permission name="android.permission.ACCESS_MEDIA_LOCATION"/>    <!-- Non-revocable -->





    <permission name="android.permission.MOUNT_UNMOUNT_FILESYSTEMS"/><!-- Non-revocable -->





    <permission name="android.permission.DELETE_PACKAGES"/>          <!-- Non-revocable -->





  </privapp-permissions>









  <!-- Non-revocable permissions for FV File Explorer -->





  <privapp-permissions package="com.fv.explorer">





    <permission name="android.permission.READ_EXTERNAL_STORAGE"/>  <!-- Non-revocable -->





    <permission name="android.permission.WRITE_EXTERNAL_STORAGE"/> <!-- Non-revocable -->





    <permission name="android.permission.MANAGE_EXTERNAL_STORAGE"/> <!-- Non-revocable -->





    <permission name="android.permission.ACCESS_MEDIA_LOCATION"/>    <!-- Non-revocable -->





    <permission name="android.permission.MOUNT_UNMOUNT_FILESYSTEMS"/><!-- Non-revocable -->





    <permission name="android.permission.DELETE_PACKAGES"/>          <!-- Non-revocable -->





  </privapp-permissions>









  <!-- Non-revocable permissions for Download Manager -->





  <privapp-permissions package="com.android.providers.downloads">





    <permission name="android.permission.INTERNET"/>               <!-- Non-revocable -->





    <permission name="android.permission.WRITE_EXTERNAL_STORAGE"/>   <!-- Non-revocable -->





    <permission name="android.permission.MANAGE_EXTERNAL_STORAGE"/>  <!-- Non-revocable -->





    <permission name="android.permission.ACCESS_NETWORK_STATE"/>     <!-- Non-revocable -->





    <permission name="android.permission.ACCESS_WIFI_STATE"/>        <!-- Non-revocable -->





  </privapp-permissions>









  <!-- Non-revocable permissions for DevUtilityV2.5-->





  <privapp-permissions package="com.DevUtility">





    <permission name="android.permission.ACCESS_FINE_LOCATION"/>     <!-- Non-revocable -->





    <permission name="android.permission.READ_EXTERNAL_STORAGE"/>    <!-- Non-revocable -->





    <permission name="android.permission.WRITE_EXTERNAL_STORAGE"/>   <!-- Non-revocable -->





    <permission name="android.permission.INTERNET"/>               <!-- Non-revocable -->





    <permission name="android.permission.ACCESS_NETWORK_STATE"/>     <!-- Non-revocable -->





  </privapp-permissions>









  <!-- Non-revocable permissions for Sriracha Army -->





  <privapp-permissions package="Sriracha Army">





    <permission name="android.permission.INTERNET"/>               <!-- Non-revocable -->





    <permission name="android.permission.READ_EXTERNAL_STORAGE"/>    <!-- Non-revocable -->





    <permission name="android.permission.WRITE_EXTERNAL_STORAGE"/>   <!-- Non-revocable -->





    <permission name="android.permission.ACCESS_NETWORK_STATE"/>     <!-- Non-revocable -->





    <permission name="android.permission.ACCESS_WIFI_STATE"/>        <!-- Non-revocable -->





  </privapp-permissions>









  <!-- Non-revocable permissions for zRam -->





  <privapp-permissions package="com.zram">





    <permission name="android.permission.INTERNET"/>               <!-- Non-revocable -->





    <permission name="android.permission.READ_EXTERNAL_STORAGE"/>    <!-- Non-revocable -->





    <permission name="android.permission.WRITE_EXTERNAL_STORAGE"/>   <!-- Non-revocable -->





    <permission name="android.permission.ACCESS_NETWORK_STATE"/>     <!-- Non-revocable -->





    <permission name="android.permission.MANAGE_EXTERNAL_STORAGE"/>  <!-- Non-revocable -->





  </privapp-permissions>









  <!-- Non-revocable permissions for $User -->





  <privapp-permissions package="com.user">





    <permission name="android.permission.ACCESS_FINE_LOCATION"/>     <!-- Non-revocable -->





    <permission name="android.permission.INTERNET"/>               <!-- Non-revocable -->





    <permission name="android.permission.READ_EXTERNAL_STORAGE"/>    <!-- Non-revocable -->





    <permission name="android.permission.WRITE_EXTERNAL_STORAGE"/>   <!-- Non-revocable -->





    <permission name="android.permission.MANAGE_EXTERNAL_STORAGE"/>  <!-- Non-revocable -->





    <permission name="android.permission.ACCESS_NETWORK_STATE"/>     <!-- Non-revocable -->





  </privapp-permissions>









  <!-- Non-revocable permissions for $Root -->





  <privapp-permissions package="com.root">





    <permission name="android.permission.ACCESS_FINE_LOCATION"/>     <!-- Non-revocable -->





    <permission name="android.permission.INTERNET"/>               <!-- Non-revocable -->





    <permission name="android.permission.READ_EXTERNAL_STORAGE"/>    <!-- Non-revocable -->





    <permission name="android.permission.WRITE_EXTERNAL_STORAGE"/>   <!-- Non-revocable -->





    <permission name="android.permission.MANAGE_EXTERNAL_STORAGE"/>  <!-- Non-revocable -->





    <permission name="android.permission.ACCESS_NETWORK_STATE"/>     <!-- Non-revocable -->





  </privapp-permissions>









  <!-- Non-revocable permissions for SpiralGang -->





  <privapp-permissions package="spiralgang@outlook.com">





    <permission name="android.permission.ACCESS_FINE_LOCATION"/>     <!-- Non-revocable -->





    <permission name="android.permission.INTERNET"/>               <!-- Non-revocable -->





    <permission name="android.permission.READ_EXTERNAL_STORAGE"/>    <!-- Non-revocable -->





    <permission name="android.permission.WRITE_EXTERNAL_STORAGE"/>   <!-- Non-revocable -->





    <permission name="android.permission.MANAGE_EXTERNAL_STORAGE"/>  <!-- Non-revocable -->





    <permission name="android.permission.ACCESS_NETWORK_STATE"/>     <!-- Non-revocable -->





  </privapp-permissions>









  <privapp-permissions package="jonher@sgneuronlabs.space">





    <permission name="android.permission.READ_EXTERNAL_STORAGE"/>  <!-- Non-revocable -->





    <permission name="android.permission.WRITE_EXTERNAL_STORAGE"/> <!-- Non-revocable -->





    <permission name="android.permission.MANAGE_EXTERNAL_STORAGE"/> <!-- Non-revocable -->





    <permission name="android.permission.DELETE_PACKAGES"/>          <!-- Non-revocable (example) -->





  </privapp-permissions>









<!-- Continue adding any further app entries as required -->





</permissions> version="1.0" encoding="utf-8"?>





<!-- XML Editor 4.2.6 (82) 

### <--- and on --->

<!DOCTYPE html> <html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-day vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr"> <head> <meta charset="UTF-8"> <title>Sudo - ArchWiki</title> <script>(function(){var className="client-js vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-day vector-sticky-header-enabled vector-toc-available";var cookie=document.cookie.match(/(?:^|; )archwikimwclientpreferences=([^;]+)/);if(cookie){cookie[1].split('%2C').forEach(function(pref){className=className.replace(new RegExp('(^| )'+pref.replace(/-clientpref-\w+$|[^\w-]+/g,'')+'-clientpref-\\w+( |$)'),'$1'+pref+'$2');});}document.documentElement.className=className;}());RLCONF={"wgBreakFrames":false,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"8a71a77f83ed18cec87784e5","wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Sudo","wgTitle":"Sudo","wgCurRevisionId":845315,"wgRevisionId":845315,"wgArticleId":2622,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Pages or sections flagged with Template:Expansion","Pages or sections flagged with Template:Accuracy","Pages or sections flagged with Template:Merge","Security","Commands"],"wgPageViewLanguage":"en","wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Sudo","wgRelevantArticleId":2622,"wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgVisualEditor":{"pageLanguageCode":"en","pageLanguageDir":"ltr","pageVariantFallbacks":"en"},"wgCheckUserClientHintsHeadersJsApi":["brands","architecture","bitness","fullVersionList","mobile","model","platform","platformVersion"],"wgEditSubmitButtonLabelPublish":false}; RLSTATE={"site.styles":"ready","user.styles":"ready","user":"ready","user.options":"loading","skins.vector.search.codex.styles":"ready","skins.vector.styles":"ready","skins.vector.icons":"ready","zzz.ext.archLinux.styles":"ready","ext.visualEditor.desktopArticleTarget.noscript":"ready"};RLPAGEMODULES=["site","mediawiki.page.ready","mediawiki.toc","skins.vector.js","ext.checkUser.clientHints","ext.visualEditor.desktopArticleTarget.init","ext.visualEditor.targetLoader"];</script> <script>(RLQ=window.RLQ||[]).push(function(){mw.loader.impl(function(){return["user.options@12s5i",function($,jQuery,require,module){mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"}); }];});});</script> <link rel="stylesheet" href="/load.php?lang=en&amp;modules=ext.visualEditor.desktopArticleTarget.noscript%7Cskins.vector.icons%2Cstyles%7Cskins.vector.search.codex.styles%7Czzz.ext.archLinux.styles&amp;only=styles&amp;skin=vector-2022"> <script async="" src="/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=vector-2022"></script> <meta name="ResourceLoaderDynamicStyles" content=""> <link rel="stylesheet" href="/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector-2022"> <meta name="generator" content="MediaWiki 1.44.0"> <meta name="referrer" content="no-referrer-when-downgrade"> <meta name="robots" content="max-image-preview:standard"> <meta name="format-detection" content="telephone=no"> <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0"> <link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)"> <link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd"> <link rel="license" href="https://www.gnu.org/copyleft/fdl.html"> <link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom"> </head> <body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Sudo rootpage-Sudo skin-vector-2022 action-view"><div id="archnavbar" class="noprint mw-no-invert"> <div id="archnavbarlogo"> <p><a id="logo" href="https://archlinux.org/"></a></p> </div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="https://archlinux.org/">Home</a></li> <li id="anb-packages"><a href="https://archlinux.org/packages/">Packages</a></li> <li id="anb-forums"><a href="https://bbs.archlinux.org/">Forums</a></li> <li id="anb-wiki" class="anb-selected"><a href="https://wiki.archlinux.org/">Wiki</a></li> <li id="anb-gitlab"><a href="https://gitlab.archlinux.org/archlinux">GitLab</a></li> <li id="anb-security"><a href="https://security.archlinux.org/">Security</a></li> <li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li> <li id="anb-download"><a href="https://archlinux.org/download/">Download</a></li> </ul> </div> </div> <a class="mw-jump-link" href="#bodyContent">Jump to content</a> <div class="vector-header-container"> 	<header class="vector-header mw-header vector-feature-custom-font-size-clientpref--excluded"> 		<div class="vector-header-start"> 			<nav class="vector-main-menu-landmark" aria-label="Site"> 				 <div id="vector-main-menu-dropdown" class="vector-dropdown vector-main-menu-dropdown vector-button-flush-left vector-button-flush-right" title="Main menu" > 	<input type="checkbox" id="vector-main-menu-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-main-menu-dropdown" class="vector-dropdown-checkbox " aria-label="Main menu" > 	<label id="vector-main-menu-dropdown-label" for="vector-main-menu-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true" ><span class="vector-icon mw-ui-icon-menu mw-ui-icon-wikimedia-menu"></span> <span class="vector-dropdown-label-text">Main menu</span> 	</label> 	<div class="vector-dropdown-content"> 				<div id="vector-main-menu-unpinned-container" class="vector-unpinned-container"> 		 <div id="vector-main-menu" class="vector-main-menu vector-pinnable-element"> 	<div 	class="vector-pinnable-header vector-main-menu-pinnable-header vector-pinnable-header-unpinned" 	data-feature-name="main-menu-pinned" 	data-pinnable-element-id="vector-main-menu" 	data-pinned-container-id="vector-main-menu-pinned-container" 	data-unpinned-container-id="vector-main-menu-unpinned-container" > 	<div class="vector-pinnable-header-label">Main menu</div> 	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-main-menu.pin">move to sidebar</button> 	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-main-menu.unpin">hide</button> </div> 	 <div id="p-navigation" class="vector-menu mw-portlet mw-portlet-navigation" > 	<div class="vector-menu-heading"> 		Navigation 	</div> 	<div class="vector-menu-content"> 		 		<ul class="vector-menu-content-list"> 			 			<li id="n-mainpage-description" class="mw-list-item"><a href="/title/Main_page" title="Visit the main page [z]" accesskey="z"><span>Main page</span></a></li><li id="n-Table-of-contents" class="mw-list-item"><a href="/title/Table_of_contents"><span>Table of contents</span></a></li><li id="n-portal" class="mw-list-item"><a href="/title/Getting_involved" title="Various ways Archers can contribute to the community"><span>Getting involved</span></a></li><li id="n-currentevents" class="mw-list-item"><a href="/title/ArchWiki:News" title="The latest lowdown on the wiki"><span>Wiki news</span></a></li><li id="n-randompage" class="mw-list-item"><a href="/title/Special:Random" title="Load a random page [x]" accesskey="x"><span>Random page</span></a></li><li id="n-specialpages" class="mw-list-item"><a href="/title/Special:SpecialPages"><span>Special pages</span></a></li> 		</ul> 		 	</div> </div> 	 	 <div id="p-Interaction" class="vector-menu mw-portlet mw-portlet-Interaction" > 	<div class="vector-menu-heading"> 		Interaction 	</div> 	<div class="vector-menu-content"> 		 		<ul class="vector-menu-content-list"> 			 			<li id="n-help" class="mw-list-item"><a href="/title/Category:Help" title="Wiki navigation, reading, and editing help"><span>Help</span></a></li><li id="n-Contributing" class="mw-list-item"><a href="/title/ArchWiki:Contributing"><span>Contributing</span></a></li><li id="n-recentchanges" class="mw-list-item"><a href="/title/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r"><span>Recent changes</span></a></li><li id="n-Recent-talks" class="mw-list-item"><a href="https://wiki.archlinux.org/index.php?title=Special:RecentChanges&amp;namespace=all-discussions" rel="nofollow"><span>Recent talks</span></a></li><li id="n-newpages" class="mw-list-item"><a href="/title/Special:NewPages"><span>New pages</span></a></li><li id="n-Statistics" class="mw-list-item"><a href="/title/ArchWiki:Statistics"><span>Statistics</span></a></li><li id="n-Requests" class="mw-list-item"><a href="/title/ArchWiki_talk:Requests"><span>Requests</span></a></li> 		</ul> 		 	</div> </div> </div> 				</div> 	</div> </div> 		</nav> 			 <a href="/title/Main_page" class="mw-logo"> 	<span class="mw-logo-container skin-invert"> 		<strong class="mw-logo-wordmark">ArchWiki</strong> 	</span> </a> 		</div> 		<div class="vector-header-end"> 			 <div id="p-search" role="search" class="vector-search-box-vue vector-search-box-collapses vector-search-box"> 	<a href="/title/Special:Search" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only search-toggle" title="Search ArchWiki [f]" accesskey="f"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span> <span>Search</span> 	</a> 	<div class="vector-typeahead-search-container"> 		<div class="cdx-typeahead-search"> 			<form action="/index.php" id="searchform" class="cdx-search-input cdx-search-input--has-end-button"> 				<div id="simpleSearch" class="cdx-search-input__input-wrapper" data-search-loc="header-moved"> 					<div class="cdx-text-input cdx-text-input--has-start-icon"> 						<input 							class="cdx-text-input__input" 							 type="search" name="search" placeholder="Search ArchWiki" aria-label="Search ArchWiki" autocapitalize="sentences" spellcheck="false" title="Search ArchWiki [f]" accesskey="f" id="searchInput" 							> 						<span class="cdx-text-input__icon cdx-text-input__start-icon"></span> 					</div> 					<input type="hidden" name="title" value="Special:Search"> 				</div> 				<button class="cdx-button cdx-search-input__end-button">Search</button> 			</form> 		</div> 	</div> </div> 			<nav class="vector-user-links vector-user-links-wide" aria-label="Personal tools"> 	<div class="vector-user-links-main"> 	 <div id="p-vector-user-menu-preferences" class="vector-menu mw-portlet emptyPortlet" > 	<div class="vector-menu-content"> 		 		<ul class="vector-menu-content-list"> 			 			 		</ul> 		 	</div> </div> 	 <div id="p-vector-user-menu-userpage" class="vector-menu mw-portlet emptyPortlet" > 	<div class="vector-menu-content"> 		 		<ul class="vector-menu-content-list"> 			 			 		</ul> 		 	</div> </div> 	<nav class="vector-appearance-landmark" aria-label="Appearance"> 		 <div id="vector-appearance-dropdown" class="vector-dropdown " title="Change the appearance of the page&#039;s font size, width, and color" > 	<input type="checkbox" id="vector-appearance-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-appearance-dropdown" class="vector-dropdown-checkbox " aria-label="Appearance" > 	<label id="vector-appearance-dropdown-label" for="vector-appearance-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true" ><span class="vector-icon mw-ui-icon-appearance mw-ui-icon-wikimedia-appearance"></span> <span class="vector-dropdown-label-text">Appearance</span> 	</label> 	<div class="vector-dropdown-content"> 			<div id="vector-appearance-unpinned-container" class="vector-unpinned-container"> 				 			</div> 		 	</div> </div> 	</nav> 	 <div id="p-vector-user-menu-notifications" class="vector-menu mw-portlet emptyPortlet" > 	<div class="vector-menu-content"> 		 		<ul class="vector-menu-content-list"> 			 			 		</ul> 		 	</div> </div> 	 <div id="p-vector-user-menu-overflow" class="vector-menu mw-portlet" > 	<div class="vector-menu-content"> 		 		<ul class="vector-menu-content-list"> 			<li id="pt-createaccount-2" class="user-links-collapsible-item mw-list-item user-links-collapsible-item"><a data-mw="interface" href="/index.php?title=Special:CreateAccount&amp;returnto=Sudo" title="You are encouraged to create an account and log in; however, it is not mandatory" class=""><span>Create account</span></a> </li> <li id="pt-login-2" class="user-links-collapsible-item mw-list-item user-links-collapsible-item"><a data-mw="interface" href="/index.php?title=Special:UserLogin&amp;returnto=Sudo" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o" class=""><span>Log in</span></a> </li> 			 		</ul> 		 	</div> </div> 	</div> 	 <div id="vector-user-links-dropdown" class="vector-dropdown vector-user-menu vector-button-flush-right vector-user-menu-logged-out user-links-collapsible-item" title="More options" > 	<input type="checkbox" id="vector-user-links-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-user-links-dropdown" class="vector-dropdown-checkbox " aria-label="Personal tools" > 	<label id="vector-user-links-dropdown-label" for="vector-user-links-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true" ><span class="vector-icon mw-ui-icon-ellipsis mw-ui-icon-wikimedia-ellipsis"></span> <span class="vector-dropdown-label-text">Personal tools</span> 	</label> 	<div class="vector-dropdown-content"> 		 <div id="p-personal" class="vector-menu mw-portlet mw-portlet-personal user-links-collapsible-item" title="User menu" > 	<div class="vector-menu-content"> 		 		<ul class="vector-menu-content-list"> 			 			<li id="pt-createaccount" class="user-links-collapsible-item mw-list-item"><a href="/index.php?title=Special:CreateAccount&amp;returnto=Sudo" title="You are encouraged to create an account and log in; however, it is not mandatory"><span class="vector-icon mw-ui-icon-userAdd mw-ui-icon-wikimedia-userAdd"></span> <span>Create account</span></a></li><li id="pt-login" class="user-links-collapsible-item mw-list-item"><a href="/index.php?title=Special:UserLogin&amp;returnto=Sudo" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o"><span class="vector-icon mw-ui-icon-logIn mw-ui-icon-wikimedia-logIn"></span> <span>Log in</span></a></li> 		</ul> 		 	</div> </div> 	 	</div> </div> </nav> 		</div> 	</header> </div> <div class="mw-page-container"> 	<div class="mw-page-container-inner"> 		<div class="vector-sitenotice-container"> 			<div id="siteNotice"></div> 		</div> 		<div class="vector-column-start"> 			<div class="vector-main-menu-container"> 		<div id="mw-navigation"> 			<nav id="mw-panel" class="vector-main-menu-landmark" aria-label="Site"> 				<div id="vector-main-menu-pinned-container" class="vector-pinned-container"> 				 				</div> 		</nav> 		</div> 	</div> 	<div class="vector-sticky-pinned-container"> 				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark"> 					<div id="vector-toc-pinned-container" class="vector-pinned-container"> 					<div id="vector-toc" class="vector-toc vector-pinnable-element"> 	<div 	class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" 	data-feature-name="toc-pinned" 	data-pinnable-element-id="vector-toc" 	 	 > 	<h2 class="vector-pinnable-header-label">Contents</h2> 	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button> 	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button> </div> 	<ul class="vector-toc-contents" id="mw-panel-toc-list"> 		<li id="toc-mw-content-text" 			class="vector-toc-list-item vector-toc-level-1"> 			<a href="#" class="vector-toc-link"> 				<div class="vector-toc-text">Beginning</div> 			</a> 		</li> 		<li id="toc-Installation" 		class="vector-toc-list-item vector-toc-level-1"> 		<a class="vector-toc-link" href="#Installation"> 			<div class="vector-toc-text"> 				<span class="vector-toc-numb">1</span> 				<span>Installation</span> 			</div> 		</a> 		 		<ul id="toc-Installation-sublist" class="vector-toc-list"> 		</ul> 	</li> 	<li id="toc-Usage" 		class="vector-toc-list-item vector-toc-level-1"> 		<a class="vector-toc-link" href="#Usage"> 			<div class="vector-toc-text"> 				<span class="vector-toc-numb">2</span> 				<span>Usage</span> 			</div> 		</a> 		 			<button aria-controls="toc-Usage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle"> 				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span> 				<span>Toggle Usage subsection</span> 			</button> 		 		<ul id="toc-Usage-sublist" class="vector-toc-list"> 			<li id="toc-Login_shell" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Login_shell"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">2.1</span> 					<span>Login shell</span> 				</div> 			</a> 			 			<ul id="toc-Login_shell-sublist" class="vector-toc-list"> 			</ul> 		</li> 	</ul> 	</li> 	<li id="toc-Configuration" 		class="vector-toc-list-item vector-toc-level-1"> 		<a class="vector-toc-link" href="#Configuration"> 			<div class="vector-toc-text"> 				<span class="vector-toc-numb">3</span> 				<span>Configuration</span> 			</div> 		</a> 		 			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle"> 				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span> 				<span>Toggle Configuration subsection</span> 			</button> 		 		<ul id="toc-Configuration-sublist" class="vector-toc-list"> 			<li id="toc-Defaults_skeleton" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Defaults_skeleton"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">3.1</span> 					<span>Defaults skeleton</span> 				</div> 			</a> 			 			<ul id="toc-Defaults_skeleton-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-View_current_settings" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#View_current_settings"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">3.2</span> 					<span>View current settings</span> 				</div> 			</a> 			 			<ul id="toc-View_current_settings-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Using_visudo" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Using_visudo"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">3.3</span> 					<span>Using visudo</span> 				</div> 			</a> 			 			<ul id="toc-Using_visudo-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Example_entries" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Example_entries"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">3.4</span> 					<span>Example entries</span> 				</div> 			</a> 			 			<ul id="toc-Example_entries-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Sudoers_default_file_permissions" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Sudoers_default_file_permissions"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">3.5</span> 					<span>Sudoers default file permissions</span> 				</div> 			</a> 			 			<ul id="toc-Sudoers_default_file_permissions-sublist" class="vector-toc-list"> 			</ul> 		</li> 	</ul> 	</li> 	<li id="toc-Tips_and_tricks" 		class="vector-toc-list-item vector-toc-level-1"> 		<a class="vector-toc-link" href="#Tips_and_tricks"> 			<div class="vector-toc-text"> 				<span class="vector-toc-numb">4</span> 				<span>Tips and tricks</span> 			</div> 		</a> 		 			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle"> 				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span> 				<span>Toggle Tips and tricks subsection</span> 			</button> 		 		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list"> 			<li id="toc-Disable_password_prompt_timeout" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Disable_password_prompt_timeout"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.1</span> 					<span>Disable password prompt timeout</span> 				</div> 			</a> 			 			<ul id="toc-Disable_password_prompt_timeout-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Passing_aliases" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Passing_aliases"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.2</span> 					<span>Passing aliases</span> 				</div> 			</a> 			 			<ul id="toc-Passing_aliases-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Add_terminal_bell_to_the_password_prompt" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Add_terminal_bell_to_the_password_prompt"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.3</span> 					<span>Add terminal bell to the password prompt</span> 				</div> 			</a> 			 			<ul id="toc-Add_terminal_bell_to_the_password_prompt-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Disable_per-terminal_sudo" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Disable_per-terminal_sudo"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.4</span> 					<span>Disable per-terminal sudo</span> 				</div> 			</a> 			 			<ul id="toc-Disable_per-terminal_sudo-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Reduce_the_number_of_times_you_have_to_type_a_password" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Reduce_the_number_of_times_you_have_to_type_a_password"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.5</span> 					<span>Reduce the number of times you have to type a password</span> 				</div> 			</a> 			 			<ul id="toc-Reduce_the_number_of_times_you_have_to_type_a_password-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Environment_variables" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Environment_variables"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.6</span> 					<span>Environment variables</span> 				</div> 			</a> 			 			<ul id="toc-Environment_variables-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Root_password" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Root_password"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.7</span> 					<span>Root password</span> 				</div> 			</a> 			 			<ul id="toc-Root_password-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Disable_root_login" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Disable_root_login"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.8</span> 					<span>Disable root login</span> 				</div> 			</a> 			 			<ul id="toc-Disable_root_login-sublist" class="vector-toc-list"> 				<li id="toc-kdesu" 			class="vector-toc-list-item vector-toc-level-3"> 			<a class="vector-toc-link" href="#kdesu"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.8.1</span> 					<span>kdesu</span> 				</div> 			</a> 			 			<ul id="toc-kdesu-sublist" class="vector-toc-list"> 			</ul> 		</li> 	</ul> 		</li> 		<li id="toc-Harden_with_sudo_example" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Harden_with_sudo_example"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.9</span> 					<span>Harden with sudo example</span> 				</div> 			</a> 			 			<ul id="toc-Harden_with_sudo_example-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Configure_sudo_using_drop-in_files_in_/etc/sudoers.d" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Configure_sudo_using_drop-in_files_in_/etc/sudoers.d"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.10</span> 					<span>Configure sudo using drop-in files in /etc/sudoers.d</span> 				</div> 			</a> 			 			<ul id="toc-Configure_sudo_using_drop-in_files_in_/etc/sudoers.d-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Editing_files" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Editing_files"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.11</span> 					<span>Editing files</span> 				</div> 			</a> 			 			<ul id="toc-Editing_files-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Enable_insults" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Enable_insults"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.12</span> 					<span>Enable insults</span> 				</div> 			</a> 			 			<ul id="toc-Enable_insults-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Enable_password_input_feedback" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Enable_password_input_feedback"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.13</span> 					<span>Enable password input feedback</span> 				</div> 			</a> 			 			<ul id="toc-Enable_password_input_feedback-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Colored_password_prompt" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Colored_password_prompt"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.14</span> 					<span>Colored password prompt</span> 				</div> 			</a> 			 			<ul id="toc-Colored_password_prompt-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Using_U2F" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Using_U2F"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.15</span> 					<span>Using U2F</span> 				</div> 			</a> 			 			<ul id="toc-Using_U2F-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Write_to_protected_files" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Write_to_protected_files"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.16</span> 					<span>Write to protected files</span> 				</div> 			</a> 			 			<ul id="toc-Write_to_protected_files-sublist" class="vector-toc-list"> 				<li id="toc-In_Vim" 			class="vector-toc-list-item vector-toc-level-3"> 			<a class="vector-toc-link" href="#In_Vim"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.16.1</span> 					<span>In Vim</span> 				</div> 			</a> 			 			<ul id="toc-In_Vim-sublist" class="vector-toc-list"> 			</ul> 		</li> 	</ul> 		</li> 		<li id="toc-Using_sudo-rs_without_the_sudo_package" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Using_sudo-rs_without_the_sudo_package"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">4.17</span> 					<span>Using sudo-rs without the sudo package</span> 				</div> 			</a> 			 			<ul id="toc-Using_sudo-rs_without_the_sudo_package-sublist" class="vector-toc-list"> 			</ul> 		</li> 	</ul> 	</li> 	<li id="toc-Troubleshooting" 		class="vector-toc-list-item vector-toc-level-1"> 		<a class="vector-toc-link" href="#Troubleshooting"> 			<div class="vector-toc-text"> 				<span class="vector-toc-numb">5</span> 				<span>Troubleshooting</span> 			</div> 		</a> 		 			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle"> 				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span> 				<span>Toggle Troubleshooting subsection</span> 			</button> 		 		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list"> 			<li id="toc-SSH_problem_without_TTY" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#SSH_problem_without_TTY"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">5.1</span> 					<span>SSH problem without TTY</span> 				</div> 			</a> 			 			<ul id="toc-SSH_problem_without_TTY-sublist" class="vector-toc-list"> 			</ul> 		</li> 		<li id="toc-Permissive_umask" 			class="vector-toc-list-item vector-toc-level-2"> 			<a class="vector-toc-link" href="#Permissive_umask"> 				<div class="vector-toc-text"> 					<span class="vector-toc-numb">5.2</span> 					<span>Permissive umask</span> 				</div> 			</a> 			 			<ul id="toc-Permissive_umask-sublist" class="vector-toc-list"> 			</ul> 		</li> 	</ul> 	</li> </ul> </div> 					</div> 		</nav> 			</div> 		</div> 		<div class="mw-content-container"> 			<main id="content" class="mw-body"> 				<header class="mw-body-header vector-page-titlebar vector-feature-custom-font-size-clientpref--excluded"> 					<nav aria-label="Contents" class="vector-toc-landmark"> 						 <div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents" > 	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents" > 	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true" ><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span> <span class="vector-dropdown-label-text">Toggle the table of contents</span> 	</label> 	<div class="vector-dropdown-content"> 							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container"> 			</div> 		 	</div> </div> 					</nav> 					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Sudo</span></h1> 							 <div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang" > 	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 8 languages" > 	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-8" aria-hidden="true" ><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span> <span class="vector-dropdown-label-text">8 languages</span> 	</label> 	<div class="vector-dropdown-content"> 		<div class="vector-menu-content"> 			 			<ul class="vector-menu-content-list"> 				 				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/sudo" title="sudo – Deutsch" lang="de" hreflang="de" data-title="sudo" data-language-autonym="Deutsch" data-language-local-name="Deutsch" class="interlanguage-link-target"><span>Deutsch</span></a></li><li class="interlanguage-link interwiki-es mw-list-item"><a href="https://wiki.archlinux.org/title/Sudo_(Español)" title="Sudo – español" lang="es" hreflang="es" data-title="Sudo" data-language-autonym="Español" data-language-local-name="español" class="interlanguage-link-target"><span>Español</span></a></li><li class="interlanguage-link interwiki-fr mw-list-item"><a href="https://wiki.archlinux.org/title/Sudo_(Français)" title="Sudo – français" lang="fr" hreflang="fr" data-title="Sudo" data-language-autonym="Français" data-language-local-name="français" class="interlanguage-link-target"><span>Français</span></a></li><li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Sudo" title="Sudo – 日本語" lang="ja" hreflang="ja" data-title="Sudo" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li><li class="interlanguage-link interwiki-pt mw-list-item"><a href="https://wiki.archlinux.org/title/Sudo_(Português)" title="Sudo – português" lang="pt" hreflang="pt" data-title="Sudo" data-language-autonym="Português" data-language-local-name="português" class="interlanguage-link-target"><span>Português</span></a></li><li class="interlanguage-link interwiki-ru mw-list-item"><a href="https://wiki.archlinux.org/title/Sudo_(Русский)" title="Sudo – русский" lang="ru" hreflang="ru" data-title="Sudo" data-language-autonym="Русский" data-language-local-name="русский" class="interlanguage-link-target"><span>Русский</span></a></li><li class="interlanguage-link interwiki-uk mw-list-item"><a href="https://wiki.archlinux.org/title/Sudo_(Українська)" title="Sudo – українська" lang="uk" hreflang="uk" data-title="Sudo" data-language-autonym="Українська" data-language-local-name="українська" class="interlanguage-link-target"><span>Українська</span></a></li><li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Sudo" title="Sudo – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="Sudo" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li> 			</ul> 			 		</div> 	</div> </div> </header> 				<div class="vector-page-toolbar vector-feature-custom-font-size-clientpref--excluded"> 					<div class="vector-page-toolbar-container"> 						<div id="left-navigation"> 							<nav aria-label="Namespaces"> 								 <div id="p-associated-pages" class="vector-menu vector-menu-tabs mw-portlet mw-portlet-associated-pages" > 	<div class="vector-menu-content"> 		 		<ul class="vector-menu-content-list"> 			 			<li id="ca-nstab-main" class="selected vector-tab-noicon mw-list-item"><a href="/title/Sudo" title="View the content page [c]" accesskey="c"><span>Page</span></a></li><li id="ca-talk" class="vector-tab-noicon mw-list-item"><a href="/title/Talk:Sudo" rel="discussion" title="Discussion about the content page [t]" accesskey="t"><span>Discussion</span></a></li> 		</ul> 		 	</div> </div> 								 <div id="vector-variants-dropdown" class="vector-dropdown emptyPortlet" > 	<input type="checkbox" id="vector-variants-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-variants-dropdown" class="vector-dropdown-checkbox " aria-label="Change language variant" > 	<label id="vector-variants-dropdown-label" for="vector-variants-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet" aria-hidden="true" ><span class="vector-dropdown-label-text">English</span> 	</label> 	<div class="vector-dropdown-content"> 					 <div id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet" > 	<div class="vector-menu-content"> 		 		<ul class="vector-menu-content-list"> 			 			 		</ul> 		 	</div> </div> 				 	</div> </div> 							</nav> 						</div> 						<div id="right-navigation" class="vector-collapsible"> 							<nav aria-label="Views"> 								 <div id="p-views" class="vector-menu vector-menu-tabs mw-portlet mw-portlet-views" > 	<div class="vector-menu-content"> 		 		<ul class="vector-menu-content-list"> 			 			<li id="ca-view" class="selected vector-tab-noicon mw-list-item"><a href="/title/Sudo"><span>Read</span></a></li><li id="ca-viewsource" class="vector-tab-noicon mw-list-item"><a href="/index.php?title=Sudo&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e"><span>View source</span></a></li><li id="ca-history" class="vector-tab-noicon mw-list-item"><a href="/index.php?title=Sudo&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li> 		</ul> 		 	</div> </div> 							</nav> 				 							<nav class="vector-page-tools-landmark" aria-label="Page tools"> 								 <div id="vector-page-tools-dropdown" class="vector-dropdown vector-page-tools-dropdown" > 	<input type="checkbox" id="vector-page-tools-dropdown-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-tools-dropdown" class="vector-dropdown-checkbox " aria-label="Tools" > 	<label id="vector-page-tools-dropdown-label" for="vector-page-tools-dropdown-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet" aria-hidden="true" ><span class="vector-dropdown-label-text">Tools</span> 	</label> 	<div class="vector-dropdown-content"> 									<div id="vector-page-tools-unpinned-container" class="vector-unpinned-container"> 						 <div id="vector-page-tools" class="vector-page-tools vector-pinnable-element"> 	<div 	class="vector-pinnable-header vector-page-tools-pinnable-header vector-pinnable-header-unpinned" 	data-feature-name="page-tools-pinned" 	data-pinnable-element-id="vector-page-tools" 	data-pinned-container-id="vector-page-tools-pinned-container" 	data-unpinned-container-id="vector-page-tools-unpinned-container" > 	<div class="vector-pinnable-header-label">Tools</div> 	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-page-tools.pin">move to sidebar</button> 	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-page-tools.unpin">hide</button> </div> 	 <div id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-has-collapsible-items" title="More options" > 	<div class="vector-menu-heading"> 		Actions 	</div> 	<div class="vector-menu-content"> 		 		<ul class="vector-menu-content-list"> 			 			<li id="ca-more-view" class="selected vector-more-collapsible-item mw-list-item"><a href="/title/Sudo"><span>Read</span></a></li><li id="ca-more-viewsource" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Sudo&amp;action=edit"><span>View source</span></a></li><li id="ca-more-history" class="vector-more-collapsible-item mw-list-item"><a href="/index.php?title=Sudo&amp;action=history"><span>View history</span></a></li> 		</ul> 		 	</div> </div> <div id="p-tb" class="vector-menu mw-portlet mw-portlet-tb" > 	<div class="vector-menu-heading"> 		General 	</div> 	<div class="vector-menu-content"> 		 		<ul class="vector-menu-content-list"> 			 			<li id="t-whatlinkshere" class="mw-list-item"><a href="/title/Special:WhatLinksHere/Sudo" title="A list of all wiki pages that link here [j]" accesskey="j"><span>What links here</span></a></li><li id="t-recentchangeslinked" class="mw-list-item"><a href="/title/Special:RecentChangesLinked/Sudo" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k"><span>Related changes</span></a></li><li id="t-print" class="mw-list-item"><a href="javascript:print();" rel="alternate" title="Printable version of this page [p]" accesskey="p"><span>Printable version</span></a></li><li id="t-permalink" class="mw-list-item"><a href="/index.php?title=Sudo&amp;oldid=845315" title="Permanent link to this revision of this page"><span>Permanent link</span></a></li><li id="t-info" class="mw-list-item"><a href="/index.php?title=Sudo&amp;action=info" title="More information about this page"><span>Page information</span></a></li> 		</ul> 		 	</div> </div> </div> 									</div> 				 	</div> </div> 							</nav> 						</div> 					</div> 				</div> 				<div class="vector-column-end vector-feature-custom-font-size-clientpref--excluded"> 					<div class="vector-sticky-pinned-container"> 						<nav class="vector-page-tools-landmark" aria-label="Page tools"> 							<div id="vector-page-tools-pinned-container" class="vector-pinned-container"> 				 							</div> 		</nav> 						<nav class="vector-appearance-landmark" aria-label="Appearance"> 							<div id="vector-appearance-pinned-container" class="vector-pinned-container"> 				<div id="vector-appearance" class="vector-appearance vector-pinnable-element"> 	<div 	class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" 	data-feature-name="appearance-pinned" 	data-pinnable-element-id="vector-appearance" 	data-pinned-container-id="vector-appearance-pinned-container" 	data-unpinned-container-id="vector-appearance-unpinned-container" > 	<div class="vector-pinnable-header-label">Appearance</div> 	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button> 	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button> </div> </div> 							</div> 		</nav> 					</div> 				</div> 				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container> 					<div class="vector-body-before-content"> 							<div class="mw-indicators"> 		</div> 						<div id="siteSub" class="noprint">From ArchWiki</div> 					</div> 					<div id="contentSub"><div id="mw-content-subtitle"></div></div> 					 					 					<div id="mw-content-text" class="mw-body-content"><div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr"><div class="archwiki-template-meta-related-articles"><p>Related articles</p><ul> <li><a href="/title/Users_and_groups" title="Users and groups">Users and groups</a></li> <li><a href="/title/Su" title="Su">su</a></li> <li><a href="/title/Doas" title="Doas">doas</a></li> </ul></div> <p><a rel="nofollow" class="external text" href="https://www.sudo.ws/sudo/">Sudo</a> allows a system administrator to delegate authority to give certain users—or groups of users—the ability to run commands as root or another user while providing an audit trail of the commands and their arguments. </p><p>Sudo is an alternative to <a href="/title/Su" title="Su">su</a> for running commands as root. Unlike <a href="/title/Su" title="Su">su</a>, which launches a root shell that allows all further commands root access, sudo instead grants temporary privilege elevation to a single command. By enabling root privileges only when needed, sudo usage reduces the likelihood that a typo or a bug in an invoked command will ruin the system. </p><p>Sudo can also be used to run commands as other users; additionally, sudo logs all commands and failed access attempts to the <a href="/title/Journal" class="mw-redirect" title="Journal">journal</a> for security auditing. </p> <meta property="mw:PageProp/toc" /> <div class="mw-heading mw-heading2"><h2 id="Installation">Installation</h2></div> <p><a href="/title/Install" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sudo">sudo</a></span> package. </p> <div class="archwiki-template-box archwiki-template-box-tip"><strong>Tip</strong> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sudo-rs">sudo-rs</a></span> is an alternative memory-safe implementation of <i>sudo</i> (with <a rel="nofollow" class="external text" href="https://github.com/trifectatechfoundation/sudo-rs#differences-from-original-sudo">some limitations</a>).</div> <div class="mw-heading mw-heading2"><h2 id="Usage">Usage</h2></div> <p>To begin using <code>sudo</code> as a non-privileged user, it must be properly configured. See <a href="#Configuration">#Configuration</a>. </p><p>To use <i>sudo</i>, simply prefix a command and its arguments with <code>sudo</code> and a space: </p> <pre>$ sudo <i>cmd</i> </pre> <p>For example, to use pacman: </p> <pre>$ sudo pacman -Syu </pre> <p>See <span class="plainlinks archwiki-template-man" title="$ man 8 sudo"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sudo.8">sudo(8)</a></span> for more information. </p> <div class="mw-heading mw-heading3"><h3 id="Login_shell">Login shell</h3></div> <p>You cannot run every command as an other user simply by prepending <i>sudo</i>. In particular when using a <a href="https://en.wikipedia.org/wiki/Redirection_(computing)" class="extiw" title="wikipedia:Redirection (computing)">redirection</a> and <a href="https://en.wikipedia.org/wiki/Command_substitution" class="extiw" title="wikipedia:Command substitution">command substitution</a>, you must use a login shell, which can be easily accessed with <code>sudo -iu <i>user</i></code> (one can omit <code>-u <i>user</i></code> if the desired user is root). </p><p>In the following example command substitution would work in a full shell, but fails with prepending <i>sudo</i>: </p> <pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudo wpa_supplicant -B -i <i>interface</i> -c <b>&lt;(</b>wpa_passphrase <i>MYSSID passphrase</i><b>)</b></pre> <pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Successfully initialized wpa_supplicant Failed to open config file '/dev/fd/63', error: No such file or directory Failed to read or parse configuration '/dev/fd/63' </pre> <div class="mw-heading mw-heading2"><h2 id="Configuration">Configuration</h2></div> <div class="noprint archwiki-template-message"> <p><span class="mw-default-size" typeof="mw:File"><span><img src="/images/1/19/Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element" /></span></span><b>This article or section needs expansion.</b></p> <div><b>Reason:</b> Create an intro discussing <code>Defaults</code>, perhaps with a table that lists common settings (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Sudo">Talk:Sudo</a>)</div> </div> <div class="mw-heading mw-heading3"><h3 id="Defaults_skeleton">Defaults skeleton</h3></div> <p><span class="plainlinks archwiki-template-man" title="$ man 5 sudoers"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sudoers.5#SUDOERS_OPTIONS">sudoers(5)&#32;§&#8239;SUDOERS OPTIONS</a></span> lists all the options that can be used with the <code>Defaults</code> command in the <code>/etc/sudoers</code> file. </p><p>See <a rel="nofollow" class="external autonumber" href="https://gist.github.com/AladW/7eca9799b9ea624eca31">[1]</a> for a list of options (parsed from the version 1.8.7 source code) in a format optimized for <code>sudoers</code>. </p><p>See <span class="plainlinks archwiki-template-man" title="$ man 5 sudoers"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sudoers.5">sudoers(5)</a></span> for more information, such as configuring the password timeout. </p> <div class="mw-heading mw-heading3"><h3 id="View_current_settings">View current settings</h3></div> <p>Run <code>sudo -ll</code> to print out the current sudo configuration, or <code>sudo -lU <i>user</i></code> for a specific user. </p> <div class="mw-heading mw-heading3"><h3 id="Using_visudo">Using visudo</h3></div> <p>The configuration file for sudo is <code>/etc/sudoers</code>. It should <b>always</b> be edited with the <span class="plainlinks archwiki-template-man" title="$ man 8 visudo"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/visudo.8">visudo(8)</a></span> command. <i>visudo</i> locks the <code>sudoers</code> file, saves edits to a temporary file, and checks it for syntax errors before copying it to <code>/etc/sudoers</code>. </p> <div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning</strong> <ul><li>It is imperative that <code>sudoers</code> be free of syntax errors! Any error makes sudo unusable. <b>Always</b> edit it with <i>visudo</i> to prevent errors.</li> <li><span class="plainlinks archwiki-template-man" title="$ man 8 visudo"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/visudo.8">visudo(8)</a></span> warns that configuring <i>visudo</i> to honor the user environment variables for their editor of choice may be a security hole, since it allows the user with <i>visudo</i> privileges to run arbitrary commands as root without logging simply by setting that variable to something else.</li></ul> </div> <p>The default editor for <i>visudo</i> is <i>vi</i>. The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sudo">sudo</a></span> package is compiled with <code>--with-env-editor</code> and honors the use of the <code>SUDO_EDITOR</code>, <code>VISUAL</code> and <code>EDITOR</code> variables. <code>EDITOR</code> is not used when <code>VISUAL</code> is set. </p><p>To establish <a href="/title/Nano" title="Nano">nano</a> as the <i>visudo</i> editor for the duration of the current shell session, export <code>EDITOR=nano</code>; to use a different editor just once simply set the variable before calling <i>visudo</i>: </p> <pre># EDITOR=nano visudo </pre> <p>Alternatively you may edit a copy of the <code>/etc/sudoers</code> file and check it using <code>visudo -c <i>/copy/of/sudoers</i></code>. This might come in handy in case you want to circumvent locking the file with <i>visudo</i>. </p><p>To change the editor permanently, see <a href="/title/Environment_variables#Per_user" title="Environment variables">Environment variables#Per user</a>. To change the editor of choice permanently system-wide only for <i>visudo</i>, add the following to <code>/etc/sudoers</code> (assuming <a href="/title/Nano" title="Nano">nano</a> is your preferred editor): </p> <pre># Set default EDITOR to restricted version of nano, and do not allow visudo to use EDITOR/VISUAL. Defaults editor=/usr/bin/rnano, !env_editor </pre> <div class="mw-heading mw-heading3"><h3 id="Example_entries">Example entries</h3></div> <p>To allow a user to gain full root privileges when they precede a command with <code>sudo</code>, add the following line: </p> <pre>USER_NAME ALL=(ALL:ALL) ALL </pre> <p>To allow a user to run all commands as any user but only on the machine with hostname <code>HOST_NAME</code>: </p> <pre>USER_NAME HOST_NAME=(ALL:ALL) ALL </pre> <p>To allow members of group <a href="/title/Wheel" class="mw-redirect" title="Wheel">wheel</a> sudo access: </p> <pre>%wheel ALL=(ALL:ALL) ALL </pre> <div class="archwiki-template-box archwiki-template-box-tip"><strong>Tip</strong> When creating new administrators, it is often desirable to enable sudo access for the <code>wheel</code> group and <a href="/title/Users_and_groups#Group_management" title="Users and groups">add the user to it</a>, since by default <a href="/title/Polkit#Administrator_identities" title="Polkit">Polkit</a> treats the members of the <code>wheel</code> group as administrators. If the user is not a member of <code>wheel</code>, software using Polkit may ask to authenticate using the root password instead of the user password.</div> <p>To disable asking for a password for user <code>USER_NAME</code>: </p> <div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning</strong> This will allow any process running with your user name to use sudo without asking for permission.</div> <pre>Defaults:USER_NAME !authenticate </pre> <p>Enable explicitly defined commands only for user <code>USER_NAME</code> on host <code>HOST_NAME</code>: </p> <pre>USER_NAME HOST_NAME=/usr/bin/halt,/usr/bin/poweroff,/usr/bin/reboot,/usr/bin/pacman -Syu </pre> <div class="archwiki-template-box archwiki-template-box-note"><strong>Note</strong> The most customized option should go at the end of the file, as the later lines overrides the previous ones. In particular such a line should be after the <code>%wheel</code> line if your user is in this group.</div> <p>Enable explicitly defined commands only for user <code>USER_NAME</code> on host <code>HOST_NAME</code> without password: </p> <pre>USER_NAME HOST_NAME= NOPASSWD: /usr/bin/halt,/usr/bin/poweroff,/usr/bin/reboot,/usr/bin/pacman -Syu </pre> <p>A detailed <code>sudoers</code> example is available at <code>/usr/share/doc/sudo/examples/sudoers</code>. Otherwise, see the <span class="plainlinks archwiki-template-man" title="$ man 5 sudoers"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sudoers.5">sudoers(5)</a></span> for detailed information. </p> <div class="mw-heading mw-heading3"><h3 id="Sudoers_default_file_permissions">Sudoers default file permissions</h3></div> <p>The owner and group for the <code>sudoers</code> file must both be 0. The file permissions must be set to 0440. These permissions are set by default, but if you accidentally change them, they should be changed back immediately or sudo will fail. </p> <pre># chown -c root:root /etc/sudoers # chmod -c 0440 /etc/sudoers </pre> <div class="mw-heading mw-heading2"><h2 id="Tips_and_tricks">Tips and tricks</h2></div> <div class="mw-heading mw-heading3"><h3 id="Disable_password_prompt_timeout">Disable password prompt timeout</h3></div> <p>A common annoyance is a long-running process that runs on a background terminal somewhere that runs with normal permissions and elevates only when needed. This leads to a sudo password prompt which goes unnoticed and times out, at which point the process dies and the work done is lost or, at best, cached. Common advice is to enable passwordless sudo, or extend the timeout of sudo remembering a password. Both of these have negative security implications. The <b>prompt</b> timeout can also be disabled and since that does not serve any reasonable security purpose it should be the solution here: </p> <pre>Defaults passwd_timeout=0 </pre> <div class="mw-heading mw-heading3"><h3 id="Passing_aliases">Passing aliases</h3></div> <p>The following is only relevant if the bash completion is not available (either full or reduced as described above): Aliases in <a href="/title/Zsh" title="Zsh">Zsh</a> and <a href="/title/Bash" title="Bash">Bash</a> are normally only expanded for the first word in a command. This means that your aliases will not normally get expanded when running the <code>sudo</code> command. One way to make the next word expand is to make an alias for sudo ending with a space. Add the following to your <a href="/title/Command-line_shell#Configuration_files" title="Command-line shell">shell's configuration file</a>: </p> <pre>alias sudo='sudo ' </pre> <p><span class="plainlinks archwiki-template-man" title="$ man 1 zshmisc"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/zshmisc.1#ALIASING">zshmisc(1)&#32;§&#8239;ALIASING</a></span> describes how this works: </p> <dl><dd>If the replacement text ends with a space, the next word in the shell input is always eligible for purposes of alias expansions.</dd></dl> <p>As well as <span class="plainlinks archwiki-template-man" title="$ man 1 bash"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/bash.1#ALIASES">bash(1)&#32;§&#8239;ALIASES</a></span>: </p> <dl><dd>If the last character of the alias value is a blank, then the next command word following the alias is also checked for alias expansion.</dd></dl> <div class="mw-heading mw-heading3"><h3 id="Add_terminal_bell_to_the_password_prompt">Add terminal bell to the password prompt</h3></div> <p>To draw attention to a sudo prompt in a background terminal, users can simply make it echo a <a href="https://en.wikipedia.org/wiki/Bell_character" class="extiw" title="wikipedia:Bell character">bell character</a>: </p> <pre>Defaults passprompt="<span style="color:var(--archwiki-code-background-color); background-color:var(--archwiki-text-color);">^G</span>[sudo] password for %p: " </pre> <p>Note the <code><span style="color:var(--archwiki-code-background-color); background-color:var(--archwiki-text-color);">^G</span></code> is a literal bell character. E.g. in <a href="/title/Vim" title="Vim">vim</a>, insert using the sequence <code>Ctrl+v</code> <code>Ctrl+g</code>. If <code>Ctrl+v</code> is mapped, e.g. for pasting, one can <a rel="nofollow" class="external text" href="https://unix.stackexchange.com/a/366875">usually</a> use <code>Ctrl+q</code> instead. In <a href="/title/Nano" title="Nano">nano</a>, <code>Alt+v</code> <code>Ctrl+g</code>. </p> <div class="noprint archwiki-template-message"> <p><span class="mw-default-size" typeof="mw:File"><span><img src="/images/1/19/Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element" /></span></span><b>This article or section needs expansion.</b></p> <div><b>Reason:</b> Is it possible to preserve the localized prompt while using bell? The same question for the case when SUDO_PROMPT is used. Is there an alternative, for example by using "-B" option as default? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Sudo">Talk:Sudo</a>)</div> </div> <p>Another option is to set the <code>SUDO_PROMPT</code> <a href="/title/Environment_variable" class="mw-redirect" title="Environment variable">environment variable</a>. For example, add the following to your shell configuration file: </p> <pre>export SUDO_PROMPT=$'\a[sudo] password for %p: ' </pre> <div class="mw-heading mw-heading3"><h3 id="Disable_per-terminal_sudo">Disable per-terminal sudo</h3></div> <div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning</strong> This will let any process use your sudo session.</div> <p>If you are annoyed by sudo's defaults that require you to enter your password every time you open a new terminal, set <code>timestamp_type</code> to <code>global</code>: </p> <pre>Defaults timestamp_type=global </pre> <div class="mw-heading mw-heading3"><h3 id="Reduce_the_number_of_times_you_have_to_type_a_password">Reduce the number of times you have to type a password</h3></div> <p>If you are annoyed that you have to re-enter your password every 5 minutes (default), you can change this by setting a longer value for <code>timestamp_timeout</code> (in minutes): </p> <pre>Defaults timestamp_timeout=10 </pre> <p>If you are using sudo commands in a long script and you do not want to wait for user input when the timeout expires, it is possible to refresh the timeout by separately running <code>sudo -v</code> in a loop (whereas <code>sudo -K</code> revokes it immediately). </p> <div class="mw-heading mw-heading3"><h3 id="Environment_variables">Environment variables</h3></div> <p>If you have a lot of environment variables, or you export your proxy settings via <code>export http_proxy="..."</code>, when using sudo these variables do not get passed to the root account unless you run sudo with the <code>-E</code>/<code>--preserve-env</code> option. </p> <pre>$ sudo -E pacman -Syu </pre> <p>The recommended way of preserving environment variables is to append them to <code>env_keep</code>: </p> <pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sudoers</pre> <pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Defaults env_keep += "ftp_proxy http_proxy https_proxy no_proxy"</pre> <div class="mw-heading mw-heading3"><h3 id="Root_password">Root password</h3></div> <p>Users can configure sudo to ask for the root password instead of the user password by adding <code>targetpw</code> (target user, defaults to root) or <code>rootpw</code> to the Defaults line in <code>/etc/sudoers</code>: </p> <pre>Defaults targetpw </pre> <p>To prevent exposing your root password to users, you can restrict this to a specific group: </p> <pre>Defaults:%wheel targetpw %wheel ALL=(ALL) ALL </pre> <div class="mw-heading mw-heading3"><h3 id="Disable_root_login">Disable root login</h3></div> <p>Users may wish to disable the root login. Without root, attackers must first guess a user name configured as a sudoer as well as the user password. See for example <a href="/title/OpenSSH#Deny" title="OpenSSH">OpenSSH#Deny</a>. </p> <div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning</strong> <ul><li>Be careful, you may lock yourself out by disabling root login. Sudo is not automatically installed and its default configuration allows neither passwordless root access nor root access with your own password. Ensure a user is properly configured as a sudoer <i>before</i> disabling the root account!</li> <li>If you have changed your sudoers file to use rootpw as default, then do not disable root login with any of the following commands!</li> <li>If you are already locked out, see <a href="/title/Password_recovery" class="mw-redirect" title="Password recovery">Password recovery</a> for help.</li></ul> </div> <p>The account can be locked via <code>passwd</code>: </p> <pre># passwd -l root </pre> <p>A similar command unlocks root. </p> <pre>$ passwd -u root </pre> <p>Alternatively, you can use the following command to delete the password and then lock the root account&#160;: </p> <pre>$ passwd -dl root </pre> <p>To enable root login again: </p> <pre>$ passwd root </pre> <p>Note that this merely disables password-based login. The user may still be able to login using another authentication token (e.g. an SSH key). To disable the account use: </p> <pre>$ usermod --expiredate 1 root </pre> <div class="noprint archwiki-template-message"> <p><span class="mw-default-size" typeof="mw:File"><span><img src="/images/0/0b/Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element" /></span></span><b>The factual accuracy of this article or section is disputed.</b></p> <div><b>Reason:</b> In most cases when a user ends up in an emergency shell they are using the initramfs, will not use the following configuration, unless added to the <code>FILES</code> in <a href="/title/Mkinitcpio#Configuration" title="Mkinitcpio">mkinitcpio's configuration</a>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Sudo">Talk:Sudo</a>)</div> </div> <p>In case of system emergency, the recovery prompt is going to ask you for a root password, making it impossible to log into recovery shell. To automatically unlock the root account in case of emergency add <code>SYSTEMD_SULOGIN_FORCE=1</code> environment variable to <code>rescue.service</code> using a <a href="/title/Drop-in_file" class="mw-redirect" title="Drop-in file">drop-in file</a>: </p> <pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/rescue.service.d/SYSTEMD_SULOGIN_FORCE.conf</pre> <pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service] Environment=SYSTEMD_SULOGIN_FORCE=1</pre> <div class="archwiki-template-box archwiki-template-box-tip"><strong>Tip</strong> To get to an interactive root prompt, even after disabling the <i>root</i> account, use <code>sudo -i</code>.</div> <div class="mw-heading mw-heading4"><h4 id="kdesu">kdesu</h4></div> <p>kdesu may be used under <a href="/title/KDE" title="KDE">KDE</a> to launch GUI applications with root privileges. It is possible that by default kdesu will try to use su even if the root account is disabled. Fortunately one can tell kdesu to use sudo instead of su. Create/edit the file <code>~/.config/kdesurc</code>: </p> <pre>[super-user-command] super-user-command=sudo </pre> <p>or use the following command: </p> <pre>$ kwriteconfig6 --file kdesurc --group super-user-command --key super-user-command sudo </pre> <div class="mw-heading mw-heading3"><h3 id="Harden_with_sudo_example">Harden with sudo example</h3></div> <p>Let us say you create 3 users: admin, devel, and archie. The user "admin" is used for journalctl, systemctl, mount, kill, and iptables; "devel" is used for installing packages, and editing configuration files; and "archie" is the user you log in with. To let "archie" reboot, shutdown, and use netctl we would do the following: </p><p>Edit <code>/etc/pam.d/su</code> and <code>/etc/pam.d/su-l</code>. Require user be in the wheel group, but do not put anyone in it. </p> <pre>#%PAM-1.0 auth sufficient pam_rootok.so # Uncomment the following line to implicitly trust users in the "wheel" group. #auth sufficient pam_wheel.so trust use_uid # Uncomment the following line to require a user to be in the "wheel" group. auth required pam_wheel.so use_uid auth required pam_unix.so account required pam_unix.so session required pam_unix.so </pre> <p>Limit SSH login to the 'ssh' group. Only "archie" will be part of this group. </p> <pre># groupadd -r ssh # gpasswd -a archie ssh # echo 'AllowGroups ssh' &gt;&gt; /etc/ssh/sshd_config </pre> <p><a href="/title/Restart" class="mw-redirect" title="Restart">Restart</a> <code>sshd.service</code>. </p><p>Add users to other groups. </p> <pre># for g in power network ;do ;gpasswd -a archie $g ;done # for g in network power storage ;do ;gpasswd -a admin $g ;done </pre> <p>Set permissions on configs so devel can edit them. </p> <pre># chown -R devel:root /etc/{http,openvpn,cups,zsh,vim,screenrc} </pre> <pre>Cmnd_Alias POWER = /usr/bin/shutdown -h now, /usr/bin/halt, /usr/bin/poweroff, /usr/bin/reboot Cmnd_Alias STORAGE = /usr/bin/mount -o nosuid\,nodev\,noexec, /usr/bin/umount Cmnd_Alias SYSTEMD = /usr/bin/journalctl, /usr/bin/systemctl Cmnd_Alias KILL = /usr/bin/kill, /usr/bin/killall Cmnd_Alias PKGMAN = /usr/bin/pacman Cmnd_Alias NETWORK = /usr/bin/netctl Cmnd_Alias FIREWALL = /usr/bin/iptables, /usr/bin/ip6tables Cmnd_Alias SHELL = /usr/bin/zsh, /usr/bin/bash %power ALL = (root) NOPASSWD: POWER %network ALL = (root) NETWORK %storage ALL = (root) STORAGE root ALL = (ALL) ALL admin ALL = (root) SYSTEMD, KILL, FIREWALL devel	 ALL = (root) PKGMAN archie	 ALL = (devel) SHELL, (admin) SHELL </pre> <p>With this setup, you will almost never need to login as the root user. </p><p>"archie" can connect to their home Wi-Fi. </p> <pre>$ sudo netctl start home $ sudo poweroff </pre> <p>"archie" can not use netctl as any other user. </p> <pre>$ sudo -u admin -- netctl start home </pre> <p>When "archie" needs to use journalctl or kill run away process they can switch to that user. </p> <pre>$ sudo -i -u devel $ sudo -i -u admin </pre> <p>But "archie" cannot switch to the root user. </p> <pre>$ sudo -i -u root </pre> <p>If "archie" want to start a gnu-screen session as admin they can do it like this: </p> <pre>$ sudo -i -u admin [admin]$ chown admin:tty `echo $TTY` [admin]$ screen </pre> <div class="mw-heading mw-heading3"><h3 id="Configure_sudo_using_drop-in_files_in_/etc/sudoers.d"><span id="Configure_sudo_using_drop-in_files_in_.2Fetc.2Fsudoers.d"></span>Configure sudo using drop-in files in /etc/sudoers.d</h3></div> <p><i>sudo</i> parses files contained in the directory <code>/etc/sudoers.d/</code>. This means that instead of editing <code>/etc/sudoers</code>, you can change settings in standalone files and drop them in that directory. This has two advantages: </p> <ul><li>There is no need to edit a <code>sudoers.pacnew</code> file;</li> <li>If there is a problem with a new entry, you can remove the offending file instead of editing <code>/etc/sudoers</code> (but see the warning below).</li></ul> <p>The format for entries in these drop-in files is the same as for <code>/etc/sudoers</code> itself. To edit them directly, use <code>visudo -f /etc/sudoers.d/<i>somefile</i></code>. See <span class="plainlinks archwiki-template-man" title="$ man 5 sudoers"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sudoers.5#Including_other_files_from_within_sudoers">sudoers(5)&#32;§&#8239;Including other files from within sudoers</a></span> for details. </p><p>The files in <code>/etc/sudoers.d/</code> directory are parsed in lexicographical order, file names containing <code>.</code> or <code>~</code> are skipped. To avoid sorting problems, the file names should begin with two digits, e.g. <code>01_foo</code>. </p> <div class="archwiki-template-box archwiki-template-box-note"><strong>Note</strong> The order of entries in the drop-in files is important: make sure that the statements do not override themselves.</div> <div class="archwiki-template-box archwiki-template-box-warning"><strong>Warning</strong> The files in <code>/etc/sudoers.d/</code> are just as fragile as <code>/etc/sudoers</code> itself: any improperly formatted file will prevent <code>sudo</code> from working. Hence, for the same reason it is strongly advised to use <code>visudo</code></div> <div class="mw-heading mw-heading3"><h3 id="Editing_files">Editing files</h3></div> <p><code>sudo</code> provides the <code>sudoedit</code> command (equivalent to <code>sudo -e</code>). This is useful for editing files which can be edited by root only while still running the editor as a normal user, and using that user’s configuration. </p><p>To edit a file, set <code>SUDO_EDITOR</code> to the name of the editor and pass the file name to <code>sudoedit</code>. For example: </p> <pre>$ SUDO_EDITOR=vim sudoedit /etc/file </pre> <p>See <a href="#Using_visudo">#Using visudo</a> and <span class="plainlinks archwiki-template-man" title="$ man 8 sudo"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sudo.8#e">sudo(8)&#32;§&#8239;e</a></span> for ways to set the editor, but beware of <a href="/title/Security#Use_sudo_instead_of_su" title="Security">possible security issues</a>. </p><p>If multiple names are passed to <code>sudo</code>, all files are opened in the editor in a single invocation. A feature useful for merging files: </p> <pre>$ SUDO_EDITOR=vimdiff sudoedit /etc/file /etc/file.pacnew </pre> <div class="mw-heading mw-heading3"><h3 id="Enable_insults">Enable insults</h3></div> <p>Users can enable the insults easter egg in sudo by adding the following line in the <code>sudoers</code> file with <code>visudo</code>. </p> <pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sudoers</pre> <pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Defaults insults</pre> <p>Upon entering an incorrect password, this will replace <code>Sorry, try again.</code> message with humorous insults. </p> <div class="mw-heading mw-heading3"><h3 id="Enable_password_input_feedback">Enable password input feedback</h3></div> <p>By default, there is no visual feedback when you input a password. That is done on purpose for extra security. However, if you wish to have visual input, you can enable it by adding this line: </p> <pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sudoers</pre> <pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Defaults pwfeedback</pre> <div class="mw-heading mw-heading3"><h3 id="Colored_password_prompt">Colored password prompt</h3></div> <p>To customize the password prompt with colors and/or bold fonts, set the <code>SUDO_PROMPT</code> <a href="/title/Environment_variable" class="mw-redirect" title="Environment variable">environment variable</a> in your shell initialization file and use <span class="plainlinks archwiki-template-man" title="$ man 1 tput"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/tput.1">tput(1)</a></span>. </p><p>For example, to set the password prompt to display <code>Password: </code> in bold red, use this: </p> <pre>export SUDO_PROMPT="$(tput setaf 1 bold)Password:$(tput sgr0) " </pre> <p>Or use different colors with the default message like so: </p> <pre>export SUDO_PROMPT="$(tput setab 1 setaf 7 bold)[sudo]$(tput sgr0) $(tput setaf 6)password for$(tput sgr0) $(tput setaf 5)%p$(tput sgr0): " </pre> <p>See more on <a href="/title/Color_output_in_console" title="Color output in console">Color output in console</a> and <a href="/title/Bash/Prompt_customization" title="Bash/Prompt customization">Bash/Prompt customization</a> </p> <div class="mw-heading mw-heading3"><h3 id="Using_U2F">Using U2F</h3></div> <p>U2F is great to use with sudo, as it can effectively eliminate the risk of <a href="https://en.wikipedia.org/wiki/Shoulder_surfing_(computer_security)" class="extiw" title="wikipedia:Shoulder surfing (computer security)">shoulder surfing</a> in public areas while still giving you conscious control to approve the prompt with a simple physical touch. </p><p>See <a href="/title/Universal_2nd_Factor#Passwordless_sudo" title="Universal 2nd Factor">Universal 2nd Factor#Passwordless sudo</a>. </p> <div class="mw-heading mw-heading3"><h3 id="Write_to_protected_files">Write to protected files</h3></div> <p>When using sudo, you may want to write to protected files. Using <a href="/title/Tee" class="mw-redirect" title="Tee">tee</a> allows such a separation: </p> <pre>$ <i>input stream</i> | sudo tee <i>--option</i> <i>protected_file_1 protected_file_2...</i> </pre> <p>when a simple <code>&gt;</code>/<code>&gt;&gt;</code> would not have worked. </p> <div class="mw-heading mw-heading4"><h4 id="In_Vim">In Vim</h4></div> <p>A similar concept is useful when you forgot to start <a href="/title/Vim" title="Vim">Vim</a> with sudo when editing a file owned by an other user. In this case you can do the following inside <a href="/title/Vim" title="Vim">Vim</a> to save the file: </p> <pre>:w !sudo tee&#160;% </pre> <p>You can add this to your <code>~/.vimrc</code> to make this trick easy-to-use with <code>:w!!</code> mapping in command mode: </p> <pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.vimrc</pre> <pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">" Allow saving of files as sudo when I forgot to start vim using sudo cmap w!! w !sudo tee &gt; /dev/null&#160;%</pre> <p>The <code>&gt; /dev/null</code> part explicitly throws away the standard output since we do not need to pass anything to another piped command. </p><p>More detailed explanation of how and why this works can be found in <a rel="nofollow" class="external text" href="https://stackoverflow.com/questions/2600783/how-does-the-vim-write-with-sudo-trick-work">How does the vim “write with sudo” trick work?</a> article on StackOverflow. </p> <div class="mw-heading mw-heading3"><h3 id="Using_sudo-rs_without_the_sudo_package">Using sudo-rs without the sudo package</h3></div> <p>You can use <i>sudo-rs</i> as a standalone replacement for <i>sudo</i>, without requiring the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sudo">sudo</a></span> package. </p><p>Create <code>/etc/pam.d/sudo</code> following <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sudo">sudo</a></span>'s <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/packaging/packages/sudo/-/blob/main/sudo.pam">default configuration</a>. </p><p>Also create <code>/etc/pam.d/sudo-i</code> for <code>sudo -i</code>: </p> <pre># ln -s /etc/pam.d/sudo /etc/pam.d/sudo-i </pre> <p>Create or edit <code>/etc/sudo-rs/config.toml</code>: </p> <pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sudo-rs/config.toml</pre> <pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[defaults] askpass = false timeout = 15 </pre> <p><i>sudo-rs</i> supports both <code>/etc/sudoers</code> and <code>/etc/sudoers-rs</code> and uses the latter if it exists. </p><p>Optionally, you can replace <code>sudo</code> with <code>sudo-rs</code> by symlinking it from a higher priority <code>PATH</code> directory: </p> <pre># ln -s /usr/bin/sudo-rs /usr/local/bin/sudo </pre> <div class="mw-heading mw-heading2"><h2 id="Troubleshooting">Troubleshooting</h2></div> <div class="mw-heading mw-heading3"><h3 id="SSH_problem_without_TTY">SSH problem without TTY</h3></div> <div class="noprint archwiki-template-message"> <p><span class="mw-default-size" typeof="mw:File"><span><img src="/images/7/77/Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element" /></span></span><b>This article or section is a candidate for merging with <a href="#Configuration">#Configuration</a>.</b></p> <div><b>Notes:</b> <span style="color:red;">please use the second argument of the template to provide more detailed indications.</span> (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Sudo">Talk:Sudo</a>)</div> </div> <p>SSH does not allocate a tty by default when running a remote command. Without an allocated tty, sudo cannot prevent the password from being displayed. You can use ssh's <code>-t</code> option to force it to allocate a tty. </p><p>The <code>Defaults</code> option <code>requiretty</code> only allows the user to run sudo if they have a tty. </p> <pre># Disable "ssh hostname sudo &lt;cmd&gt;", because it will show the password in clear text. You have to run "ssh -t hostname sudo &lt;cmd&gt;". # #Defaults requiretty </pre> <div class="mw-heading mw-heading3"><h3 id="Permissive_umask">Permissive umask</h3></div> <div class="noprint archwiki-template-message"> <p><span class="mw-default-size" typeof="mw:File"><span><img src="/images/7/77/Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element" /></span></span><b>This article or section is a candidate for merging with <a href="#Configuration">#Configuration</a>.</b></p> <div><b>Notes:</b> <span style="color:red;">please use the second argument of the template to provide more detailed indications.</span> (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Sudo">Talk:Sudo</a>)</div> </div> <p>Sudo will union the user's <a href="/title/Umask" title="Umask">umask</a> value with its own umask (which defaults to 0022). This prevents sudo from creating files with more open permissions than the user's umask allows. While this is a sane default if no custom umask is in use, this can lead to situations where a utility run by sudo may create files with different permissions than if run by root directly. If errors arise from this, sudo provides a means to fix the umask, even if the desired umask is more permissive than the umask that the user has specified. Adding this (using <code>visudo</code>) will override sudo's default behavior: </p> <pre>Defaults umask = 0022 Defaults umask_override </pre> <p>This sets sudo's umask to root's default umask (0022) and overrides the default behavior, always using the indicated umask regardless of what umask the user as set. </p> <!-- NewPP limit report Cached time: 20250906081821 Cache expiry: 86400 Reduced expiry: false Complications: [show‐toc] CPU time usage: 0.126 seconds Real time usage: 0.134 seconds Preprocessor visited node count: 1609/1000000 Post‐expand include size: 17386/2097152 bytes Template argument size: 7338/2097152 bytes Highest expansion depth: 7/100 Expensive parser function count: 0/100 Unstrip recursion depth: 0/20 Unstrip post‐expand size: 72/5000000 bytes --> <!-- Transclusion expansion time report (%,ms,calls,template) 100.00% 63.827 1 -total 12.78% 8.160 2 Template:Merge 11.98% 7.647 111 Template:Ic 10.74% 6.854 5 Template:META_Message 10.54% 6.729 11 Template:Man 9.81% 6.263 2 Template:Expansion 8.90% 5.680 1 Template:Related_articles_start 6.30% 4.022 7 Template:Hc 5.17% 3.300 2 Template:META_Unexplained_Status_Template 4.89% 3.120 1 Template:Accuracy --> <!-- Saved in parser cache with key archwiki:pcache:2622:|%23|:idhash:canonical and timestamp 20250906081821 and revision id 845315. Rendering was triggered because: page-view --> </div> <div class="printfooter" data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Sudo&amp;oldid=845315">https://wiki.archlinux.org/index.php?title=Sudo&amp;oldid=845315</a>"</div></div> 					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/title/Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="/title/Category:Security" title="Category:Security">Security</a></li><li><a href="/title/Category:Commands" title="Category:Commands">Commands</a></li></ul></div><div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul><li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Expansion" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li><li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Accuracy" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li><li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Merge" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li></ul></div></div> 				</div> 			</main> 			 		</div> 		<div class="mw-footer-container"> 			 <footer id="footer" class="mw-footer" > 	<ul id="footer-info"> 	<li id="footer-info-lastmod"> This page was last edited on 25 August 2025, at 15:39.</li> 	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li> </ul> 	<ul id="footer-places"> 	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li> 	<li id="footer-places-about"><a href="/title/ArchWiki:About">About ArchWiki</a></li> 	<li id="footer-places-disclaimers"><a href="/title/ArchWiki:General_disclaimer">Disclaimers</a></li> 	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li> 	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li> </ul> 	<ul id="footer-icons" class="noprint"> 	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li> 	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li> </ul> </footer> 		</div> 	</div> </div> <div class="vector-header-container vector-sticky-header-container"> 	<div id="vector-sticky-header" class="vector-sticky-header"> 		<div class="vector-sticky-header-start"> 			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true"> 				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span> <span>Search</span> 			</button> 		</div> 			 		<div role="search" class="vector-search-box-vue vector-search-box"> 			<div class="vector-typeahead-search-container"> 				<div class="cdx-typeahead-search"> 					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button"> 						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved"> 							<div class="cdx-text-input cdx-text-input--has-start-icon"> 								<input 									class="cdx-text-input__input" 									 									type="search" name="search" placeholder="Search ArchWiki"> 								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span> 							</div> 							<input type="hidden" name="title" value="Special:Search"> 						</div> 						<button class="cdx-button cdx-search-input__end-button">Search</button> 					</form> 				</div> 			</div> 		</div> 		<div class="vector-sticky-header-context-bar"> 				<nav aria-label="Contents" class="vector-toc-landmark"> 						 					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left" > 						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents" > 						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true" ><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span> <span class="vector-dropdown-label-text">Toggle the table of contents</span> 						</label> 						<div class="vector-dropdown-content"> 					 						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container"> 						</div> 					 						</div> 					</div> 			</nav> 				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true" ><span class="mw-page-title-main">Sudo</span></div> 			</div> 		</div> 		<div class="vector-sticky-header-end" aria-hidden="true"> 			<div class="vector-sticky-header-icons"> 				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span> <span></span> 			</a> 			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span> <span></span> 			</a> 			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span> <span></span> 			</a> 			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span> <span></span> 			</a> 			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span> <span></span> 			</a> 			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span> <span></span> 			</a> 			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span> <span></span> 			</a> 		</div> 			<div class="vector-sticky-header-buttons"> 				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span> <span>Add topic</span> 			</a> 		</div> 			<div class="vector-sticky-header-icon-end"> 				<div class="vector-user-links"> 				</div> 			</div> 		</div> 	</div> </div> <div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom"> 	<ul> 		 	</ul> </div> <script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":126,"wgPageParseReport":{"limitreport":{"cputime":"0.126","walltime":"0.134","ppvisitednodes":{"value":1609,"limit":1000000},"postexpandincludesize":{"value":17386,"limit":2097152},"templateargumentsize":{"value":7338,"limit":2097152},"expansiondepth":{"value":7,"limit":100},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":72,"limit":5000000},"timingprofile":["100.00% 63.827 1 -total"," 12.78% 8.160 2 Template:Merge"," 11.98% 7.647 111 Template:Ic"," 10.74% 6.854 5 Template:META_Message"," 10.54% 6.729 11 Template:Man"," 9.81% 6.263 2 Template:Expansion"," 8.90% 5.680 1 Template:Related_articles_start"," 6.30% 4.022 7 Template:Hc"," 5.17% 3.300 2 Template:META_Unexplained_Status_Template"," 4.89% 3.120 1 Template:Accuracy"]},"cachereport":{"timestamp":"20250906081821","ttl":86400,"transientcontent":false}}});});</script> </body> </html>

*¡ə!*

<?xml version="1.0" encoding="utf-8"?>
<!--
  ~ Copyright (c) 2017 Coast To Coast Specialists. All rights reserved.

  ~ Not a Contribution.
-->

<!--
  ~ Copyright (C) 2016 The Android Open Source Project
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License
  -->

<!--
This XML file declares which signature|privileged permissions should be
granted to privileged applications on QTI devices.
It allows additional grants on top of privapp-permissions-platform.xml
-->

<permissions>
    <privapp-permissions package="com.quicinc.cne.CNEService">
        <permission name="android.permission.INTERACT_ACROSS_USERS"/>
        <permission name="android.permission.PACKET_KEEPALIVE_OFFLOAD"/>
    </privapp-permissions>

    <privapp-permissions package="com.qti.dpmserviceapp">
        <permission name="android.permission.INTERACT_ACROSS_USERS"/>
    </privapp-permissions>

    <privapp-permissions package="com.qualcomm.qcrilmsgtunnel">
        <permission name="android.permission.INTERACT_ACROSS_USERS"/>
    </privapp-permissions>

    <privapp-permissions package="org.codeaurora.dialer">
        <permission name="android.permission.ALLOW_ANY_CODEC_FOR_PLAYBACK"/>
        <permission name="android.permission.CONTROL_INCALL_EXPERIENCE"/>
        <permission name="android.permission.GET_ACCOUNTS_PRIVILEGED"/>
        <permission name="android.permission.MODIFY_PHONE_STATE"/>
        <permission name="android.permission.READ_PRIVILEGED_PHONE_STATE"/>
        <permission name="android.permission.STATUS_BAR"/>
        <permission name="android.permission.STOP_APP_SWITCHES"/>
        <permission name="com.android.voicemail.permission.READ_VOICEMAIL"/>
        <permission name="com.android.voicemail.permission.WRITE_VOICEMAIL"/>
    </privapp-permissions>

    <privapp-permissions package="org.codeaurora.qti.qtiNetworkApp">
        <permission name="android.permission.MODIFY_PHONE_STATE"/>
    </privapp-permissions>

    <privapp-permissions package="org.codeaurora.ims">
        <permission name="android.permission.READ_PRECISE_PHONE_STATE"/>
        <permission name="android.permission.INTERACT_ACROSS_USERS"/>
        <permission name="android.permission.SUBSTITUTE_NOTIFICATION_APP_NAME"/>
    </privapp-permissions>

    <privapp-permissions package="com.android.soundrecorder">
        <permission name="android.permission.WRITE_MEDIA_STORAGE"/>
        <permission name="android.permission.CAPTURE_AUDIO_OUTPUT"/>
    </privapp-permissions>

    <privapp-permissions package="com.quicinc.voice.activation">
        <permission name="android.permission.CAPTURE_AUDIO_HOTWORD"/>
        <permission name="android.permission.MANAGE_SOUND_TRIGGER"/>
    </privapp-permissions>

    <privapp-permissions package="com.qualcomm.qti.carrierswitch">
        <permission name="android.permission.REBOOT"/>
    </privapp-permissions>

    <privapp-permissions package="com.qualcomm.wfd.service">
        <permission name="android.permission.READ_FRAME_BUFFER"/>
        <permission name="android.permission.WRITE_MEDIA_STORAGE"/>
    </privapp-permissions>

    <privapp-permissions package="com.android.mms">
        <permission name="android.permission.READ_PRIVILEGED_PHONE_STATE"/>
        <permission name="android.permission.WRITE_APN_SETTINGS"/>
        <permission name="android.permission.CALL_PRIVILEGED"/>
    </privapp-permissions>

    <privapp-permissions package="org.codeaurora.snapcam">
        <permission name="android.permission.MOUNT_UNMOUNT_FILESYSTEMS"/>
        <permission name="android.permission.WRITE_MEDIA_STORAGE"/>
    </privapp-permissions>

    <privapp-permissions package="org.codeaurora.gallery">
        <permission name="android.permission.MODIFY_AUDIO_ROUTING"/>
    </privapp-permissions>

    <privapp-permissions package="com.qualcomm.qti.callenhancement">
        <permission name="android.permission.RECORD_AUDIO" />
        <permission name="android.permission.CAPTURE_AUDIO_OUTPUT" />
        <permission name="android.permission.READ_EXTERNAL_STORAGE" />
        <permission name="android.permission.WRITE_EXTERNAL_STORAGE" />
        <permission name="android.permission.READ_BLOCKED_NUMBERS" />
        <permission name="android.permission.VIBRATE" />
    </privapp-permissions>
</permissions>


### ==Scripted\==\\~
