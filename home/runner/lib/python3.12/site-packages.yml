eslint . || true     # JavaScript linter
pylint . || true     # Python linter
      - job: deploy_function_app
        displayName: Deploy Function App
        pool:
          name: ccoe-aks-linux-agent
        steps:
          - task: Bash@3
            inputs:
              targetType: "inline"
              script: |
                echo "##vso[task.setvariable variable=LD_LIBRARY_PATH;]:{TOOLCACHE_PATH}/Python/{VERSION}/x64/lib/"
          - task: UsePythonVersion@0
            displayName: "Set Python version to 3.11"
            inputs:
              versionSpec: "3.11.8"
              githubToken: <MY_TOKEN>
              architecture: "x64"
          - bash: |
              if [ -f extensions.csproj ]
              then
                  dotnet build extensions.csproj --output ./bin
              fi
              pip install --target="./.python_packages/lib/site-packages" -r ./requirements.txt
            workingDirectory: $(functionAppWorkingDirectory)
          - task: ArchiveFiles@2
            displayName: "Archive files"
            inputs:
              rootFolderOrFile: "$(functionAppWorkingDirectory)"
              includeRootFolder: false
              archiveFile: "$(System.DefaultWorkingDirectory)/build$(Build.BuildId).zip"
          - task: PublishBuildArtifacts@1
            inputs:
              PathtoPublish: "$(System.DefaultWorkingDirectory)/build$(Build.BuildId).zip"
              artifactName: "drop"
          - task: AzureFunctionApp@2
            inputs:
              azureSubscription: app-ai-devops-knowledgebot-dev-001
              appType: functionAppLinux
              appName: $(functionAppName)
              package: $(System.DefaultWorkingDirectory)/build$(Build.BuildId).zip
              deploymentMethod: "auto"   
              name: Node.js CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npm run lint
      - run: npm run format
